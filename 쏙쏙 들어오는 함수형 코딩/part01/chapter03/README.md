## chapter03. 액션과 계산, 데이터의 차이 알기


### 액션과 계산, 데이터

함수형 프로그래머는 액션과 계산, 데이터를 구분한다.

액션

* 실행 시점과 횟수에 의존한다.
* 다른 말로 사이드 이펙트, 사이드이펙트가 있는 함수, 순수하지 않은 함수라고 부른다.
* 예시는 이메일 보내기, 데이터베이스 읽기

계산

* 입력으로 출력을 계산한다.
* 다른 말로 순수함수, 수학 함수라고 부른다.
* 최댓값 찾기, 이메일 주소가 올바른지 확인하기

데이터

* 이벤트에 대한 사실
* 사용자가 입력한 이메일 주소, 은행 API로 읽은 달러 수

모든 개발 과정에서 액션과 계산, 데이터를 구분하는 기술을 적용할 수 있다. 각 단계별로 아래와 같이 적용해볼 수 있다.

#### 1. 문제에 대해 생각할 때

코딩 시작전에 문제에 대문제를 액션과 계산, 데이터로 나눠보면 코드를 작성할 때 특별히 주의해야할 부분(액션)과 데이터로 처리해야할 부분, 결정을 내려야하는 부분(계산)
을 명확히 알 수 있다.

#### 2. 코딩할 때

함수형 프로그래머는 최대한 액션에서 계산을 빼내려고 한다. 또 계산에서는 데이터를 분리할 수 있는지 생각한다.
더 나아가 액션이 계산이 될 수 있는지, 계산은 데이터가 될 수 있는지 고민한다.

#### 3. 코드를 읽을 때

코드를 읽을 때 액션과 계산, 데이터 중에 어떤 것에 속하는지 잘 살펴봐야 한다.
특히 액션은 시간에 의존하기 때문에 더 조심해야 한다.
그래서 언제나 숨어있는 액션까지도 찾아야 한다.

함수형 프로그래머는 더 좋은 코드를 만들기 위해 이미 있는 코드를 액션과 계산, 데이터로 리팩터링하는 방법을 찾을 것이다.

### 액션과 데이터는 어디에나 적용할 수 있다.

* 냉장고 확인하기 -> 액션: 내일은 내용물이 다를지도
* 운전해서 상점으로 가기 -> 액션
* 필요한 것 구입하기 -> 액션 : 구입하는 시점이 중요
* 운전해서 집으로 오기 -> 액션 : 이미 집에 있다면 상점에 있는 것이 아니기 때문에 상점에서 집으로 올 수 없음.

모든 것이 액션인데?

놓친 것이 있나 확인해보자.

#### 냉장고 확인하기

* 냉장고를 확인하는 시점이 중요하므로 액션
* 냉장고에 있는 제품은 데이터다. 이것을 현재 재고라고 부르자

#### 운전해서 집으로 가기

* 운전해서 상점으로 가는 것은 명확히 액션
* 역기에는 데이터가 있는데, 상점 위치나 가는 경로는 데이터다.
* 그러나 분리하지 않겠다.

#### 필요한 것 구입하기

* 구입하는 것도 액션
* 구입도 과정을 나눌 수 있다.
* 필요한 것을 구입하려면 필요한 것이 무엇인지 알아야 한다.
* 필요한 것은 어떻게 알 수 있을까? 어떻게 장을 볼지에 따라 다르지만 필요하지만 없는 제품의 목록을 만드는 것이 가장 쉽다.

> 필요한 재고 - 현재 재고 = 장보기 목록

앞에 '냉장고 확인하기' 단계에서 만든 현재 재고 데이터를 사용했다.

또한 위의 공식은 계산이다. 재고 빼기는 같은 입력값일 때 항상 같은 결괏값을 주기 때문이다.


#### 운전해서 집으로 오기

* 일단 액션으로 처리

처음에는 모두 액션 같아 보였지만 나누다보니 우리는 결국 데이터, 액션, 계산을 모두 찾아냈다.

계쏙 나누다 보면 점점 더 복잡해진다고 생각할 수 있다. 하지만 액션에 숨어 있는 다른 액션이나 계산 또는 데이터를 발견하기 위해 나눌 수 있는 만큼 나누는 것이 좋다.


### 장보기 과정에서 배운 것

1. 액션과 계산 데이터는 어디에나 적용할 수 있다
2. 액션 안에는 계산과 데이터, 또 다른 액션이 숨어 있을지도 모른다.
3. 계산은 더 작은 계산과 데이터로 나누고 연결할 수 있다.
4. 데이터는 데이터만 조합할 수 있다.
5. 계산은 따로 '우리 머릿속에서' 일어난다.

### 데이터

1. 데이터는 이벤트에 대한 사실이다. 일어난 일의 결과를 기록한 것
2. JS에서는 데이터를 기본타입으로 구현. 데이터는 숫자나 문자, 배열, 객체 같은 것이다.
3. 데이터 구조로 의미를 담을 수 있다. 목록의 순서가 중요하다면 순서를 보장하는 데이터 구조 사용. 데이터 구조로 도메인을 표현할 수 있다.
4. 불변성, 함수형 프로그래머는 불변 데이터 구조를 만들기 위해 두 가지 원칙을 사용한다.
   1. 변경할 때 복사본을 생성
   2. 보관하려고 하는 데이터의 복사본을 만든다.
5. 데이터의 장접은 직렬화, 동일성 비교, 자유로운 해석이다.
6. 단점은 해석이 반드시 필요하다는 점이다.

### 새로 만드는 코드에 함수형 코드 적용하기

쿠폰독은쿠폰에 관심 있는 구독자들에게 이메일로 쿠폰을 매주 보내는 서비스다. 친구를 초대하면 더 좋은 쿠폰을 주려고 한다.

쿠폰독은 커다란 이메일 데이터베이스가 있다. 여기에는 이메일별로 각 사용자가 추천한 친구 수도 기록하고 있다.

쿠폰에 대한 정보를 가지고 있는 데이터베이스도 있다.

쿠폰 데이터베이스는 각 쿠폰에 'bad', 'good', 'best' 같은 등급 정보도 있다.

best 쿠폰은 추천을 많이 한 사용자를 위한 쿠폰이고 good 쿠폰은 모든 사용자들에게 전달되는 쿠폰이고 'bad' 쿠폰은 사용하지 않기 때문에 사용자에게 전달되지 않는다.

#### 내 답: 정답

1. 이메일 보내기 A
2. 데이터베이스에서 구독자 가져오기 A
3. 쿠폰에 등급 매기기 C X -> D 
4. 데이터베이스에서 쿠폰 읽기 A
5. 이메일 제목 D
6. 이메일 주소 D
7. 추천수 D
8. 어떤 이메일이 쿠폰 받을지 결정하기 A -> C
9. 구독자 DB 레코드 D
10. 쿠폰 DB 레코드 D
11. 쿠폰 목록 DB 레코드 D
12. 구독자 목록 DB 레코드 D
13. 이메일 본문 D

#### 쿠폰 보내는 과정을 그려보기 

1. 데이터베이스에서 구독자를 가져오기 -> 액션, 가져온 구독자 목록은 데이터
2. 데이터베이스에서 쿠폰 목록 가져오기 -> 액션, 가져온  쿠폰 목록은 데이터
3. 보내야할 이메일 목록 만들기 -> 계산, 데이터인 구독자 목록과 쿠폰 목록을 가져와 이메일 목록 계획하기를 진행.
4. 이메일 전송하기 -> 이메일 보내기는 이메일 목록의 데이터를 보고 액션을 수행하는 것.

#### 이메일 목록 만들기

이메일 목록을 계획하는 계신은 구독자 목록 데이터와 쿠폰 목록 데이터를 받는다. 그리고 계산한 결과는 이메일 목록이다.

계산으로 바꿀 수 있는 액션이 있다면 그렇게 하는 것이 좋다. 

계산으로 빼는 이유는 테스트하기 쉽기 때문이다. 이메일을 실제로 보내고 결과를 주는 시스템은 테스트하기 어렵다.

하짐나 결과가 이메일 목록 데이터인 시스템은 테스트하기 쉽다.

더 자세히 계산을 나눠보자. 

* 쿠폰 목록에서 good 쿠폰 목록과 best 쿠폰 목록을 계산할 수 있다.
* 그리고 어떤 구독자가 good 쿠폰을 받을지 best 쿠폰을 받을지 결정하는 것을 계산으로 만들 수 있다.
* 그럼 쿠폰 등급을 결정하고, 쿠폰 등급에 따라 이메일 만들기를 계산으로 만들 수 있다.

### 쿠폰 보내는 과정 구현하기

> AppV1.js 참고

쉬는 시간 예제를 보니 청크 방식이 이메일 발송에 효율적이라고 한다.

### 계산이란

* 계산은 입력값으로 출력값을 만든다. 
* 실행시점과 횟수에 상관 없이 항상 같은 입력값에 대해 같은 출력값을 돌려준다.
* 계산은 함수로 구현
* 계싼에는 연산을 담을 수 있다.
* 계산은 입력값을 출력값으로 만드는 것을 표현
* 계산의 장점은 테스트하기 쉽고, 기계적인 분석이 쉽다. 마지막으로 계산은 조합해 더 큰 계산을 만들기 유용하다.
* 계산의 예는 더하기, 곱하기, 문자열 합치기, 쇼핑 계획하기
* 계산을 사용하면 동시에 실행되는 것, 과거에 실행되었던 것이나 미래에 실행하는 것, 실행횟수에 대한 걱정을 하지 않아도 된다.
* 계산과 액션의 단점은 실행하기 전에 어떤일이 발생할지 알 수 없다는 점이다.
* 계산은 순수 함수, 수학 함수라고 부른다.

### 이미 있는 코드에 함수형 사고 적용하기

> AppV2.js 참고

### 액션은 코드 전체로 퍼진다.

예시 코드는 함수형 사고를 적용하지 않은 코드다.

액션을 부르는 함수가 있다면 그 함수도 액션이 된다. 이런식으로 작은 액션 하나가 코드 전체로 퍼진다.

### 액션은 다양한 형태로 나타난다.

JS 예시다.

* 함수 호출: alert()
* 메서드 호출: console.log()
* 생성자: new Date()
* 표현식: 변수 참조, 속성 참조, 배열 참조 -> 가변 변수라면 읽는 시점에 따라 값이 다를 수 있기 때문
* 상태: 변경 가능한 변수나, 속성을 지우는 것은 다른 코드에 영향을 준다.

### 액션

* 액션은 외부 세계에 영향을 주거나 받느 ㄴ것을 말한다. 액션은 실행 시점과 횟수에 의존
* 액션은 계산과 마찬가지로 함수로 구현
* 액션은 외부 세계에 영향을 준다. 예시는 이멜 보내기, 계좌 인출, 전역변숫값 바꾸기, ajax 요청
* 순수하지 않은 함수, 사이드 이펙트가 있는 함수라고 부른다.
* 액션은 다루기 어렵고, 우리가 소프트웨어를 실행하는 중요한 이유다.

최대한 액션을 적게 사용하고, 액션 관련 코드는 작게 만들어야 한다.

액션이 외부 세계와 상호작용하는 것을 제한할 수 있고, 액션이 호출 시점에 의존하는 것을 제한해야 한다.