## chapter08. 게층형 설계 1

### 소프트웨어 설계란 ?

소프트웨어 설계란? 

일반적인 정의는 아래와 같다.

> 코드를 만들고, 테스트하고, 유지보수하기 쉬운 프로그래밍 방법을 선택하기 위해 미적 감각을 사용하는 것

### 계층형 설계란 ?

계층형 설계는 소프트웨어를 계층으로 구성하는 기술이다. 각 계층에 있는 함수는 바로 아래 계층에 있는 함수를 이용해 정의한다.

![KakaoTalk_Photo_2024-02-16-23-43-51](https://github.com/happysubin/about-backend-lecture-study/assets/76802855/20c3e81a-b9de-4b75-84f1-e73ef9a25d8a)

좋은 설계를 하기 위해서는 감각을 개발하고 그 감각을 따라가야 한다. 이 감각은 계속 갈고 닦아야한다.

### 설계 감각 키우기

계층형 설계 감각을 키우기 위해 다양한 입력을 생각해볼 수 있다. 그리고 이런 입력들은 계층형 설계에 대한 단서가 된다.

코드를 읽고 단서를 찾고 게층형 설계를 위한 길잡이로 사용해 보자. 다음은 몇 가지 단서들이다.

#### 함수 본문

* 길이
* 복잡성
* 구체화 단계
* 함수 호출
* 프로그래밍 언어의 기능 사용

#### 계층 구조

* 화살표 길이
* 응집도
* 구체화 단계

#### 함수 시그니처

* 함수명
* 인자 이름
* 인잣값
* 리턴값

### 계층 설계 감각을 키우기 위한 출력

#### 조직화

* 새로운 함수를 어디에 놓을지 결정
* 함수를 다른 곳으로 이동

#### 구현

* 구현 바꾸기
* 함수 추출
* 데이터 구조 바꾸기

#### 변경

* 새 코드를 작성할 곳 선택하기
* 적절한 수준의 구체화 단계 결정하기

### 계층형 설계 패턴

계층형 설계에 대해 가장 중요한 네 가지 패턴은 아래와 같다.

1. 직접 구현
2. 추상화 벽
3. 작은 인터페이스
4. 편리한 계층

### 패턴 1. 직접 구현

Implement.js를 참고. 설계를 하지 않고 일단 기능 추가를 서둘렀다.

#### 장바구니 동작 설계 개선

장바구니 설계를 개선하기 위해 설계 스프린트를 진행해 장바구니가 할 동작을 정리했다.

장바구니에 제품이 있는지 확인하는 기능과, 장바구니 비우기 기능을 추가하기로 결정함

__제품이 있는지 확인하는 함수를 만들어 설계를 개선__

#### 호출 그래프를 만들어 함수 호출을 시각화하기

* 반복문과 배열 인덱스를 참조하는 부분은 언어적 기능이다. 
* make_item() 함수와 add_item() 함수는 직접 만든 함수
* 직접 만든 함수와 언어적 기능을 비교하면 언어적 기능이 더 낮은 추상화 단계다.


![KakaoTalk_Photo_2024-02-17-11-08-04](https://github.com/happysubin/about-backend-lecture-study/assets/76802855/b04385de-fd74-4f8c-b846-9ab4c7144c4d)

__직접 구현 패턴을 사용하면 비슷한 추상화 계층에 있는 함수를 호출한다.__

개선된 함수를 통해 이제 더 가까운 추상화 계층을 호출할 수 있다.

![KakaoTalk_Photo_2024-02-17-11-09-51](https://github.com/happysubin/about-backend-lecture-study/assets/76802855/3040efc7-8ed9-4f8f-995f-dc5017cb845a)

다이어그램이 나쁘지 않은 것 같다 여러모로...


#### remove_item_by_name() 함수 그래프 그리기

배열 인덱스와 루프문과 removeItems() 함수를 사용한다. remove_item_by_name()는 어느 계층에 포함될까?

add_item(), isInCart(), make_item()과 같은 제일 낮은 계층에 포함됨. 정답을 맞췄다.


### 같은 계층에 있는 함수는 같은 목적을 가져야 한다.

현대 6개의 계층은 아래와 같은 목적을 수행한다.



1. 장바구니 비즈니스 규칙
2. 일반적인 비즈니스 규칙
3. 장바구니 기본 동작
4. 제품에 대한 기본동작
5. 카피-온-라이트 동작
6. 자바스크립트 언어기능

각 계층은 추상화 수준이 다르다. 그래서 어떤 계층에 있는 함수를 읽거나 고칠 때 낮은 수준의 구체적인 내용은 신경 쓰지 않아도 된다.

다이어그램은 함수를 어떤 계층에 놓을지 바로 알 수 있어서 코드를 높은 차원에서 볼 수 있는 좋은 도구다.

### 3단계 줌 레벨

다이어그램에서도 문제를 찾을 수 있지만 너무 많은 정보가 있어 문제를 찾기 어렵다.
계층형 설계에서 문제는 세 가지 다른 영역에서 찾을 수 있다.

1. 계층 사이에 상호 관계
2. 특정 계층의 구현
3. 특정 함수의 구현

문제를 찾기 위해 알맞은 줌 레벨을 사용해 하나의 영역을 살펴볼 수 있다.

#### 1. 전역 줌 레벨

전역 줌 레벨로 그래프 전체 중 필요한 부분을 살펴볼 수 있다. 전역 줌 레벨이 기본 줌 ㅔ벨.

계층 사이에 상호 관계를 포함해 모든 문제영역을 살펴볼 수 있다.

#### 2. 계층 줌 레벨

계층 줌 레벨은 한계층과 연결된 바로 아래 계층을 살펴볼 수 있다. 

#### 3. 함수 줌 레벨

함수 하나와 바로 아래 연결된 함수들을 볼 수 있다.

#### 계층 줌 레벨로 보면 함수가 가리키는 화살표를 계층 간에 비교할 수 있다.

직접 구현 패턴을 사용하면 모든 화살표가 같은 길이를 가져야 한다. 우리 다이어그램은 아직 모두 같은 화살표 길이를 가지지 않는다.

이렇게 다양한 계층을 넘나드는 것은 같은 구체화 수준이 아니라는 것이다.

![KakaoTalk_Photo_2024-02-17-11-43-31](https://github.com/happysubin/about-backend-lecture-study/assets/76802855/ee24195e-35e7-4891-b5bf-b62613a4a627)


#### 함수 줌 레벨을 사용하면 함수 하나가 가진 화살표를 비교할 수 있다.

remove_item_by_name은 다른 두 계층에 화살표가 연결되어있다. 이 문제를 해결하기 위해서 중간 함수를 둬서 코드에서 반복문을 뺄 것이다.

indexOfItem() 함수를 추가해서 같은 화살표 길이를 가지게 수정했다.

setPriceName도 계층을 맞추기 위해 리팩토링을 진행

근데 설계는 역시 트레이드 오프... 개인적으로 배열 인덱스는 계층 안맞아도 그냥 사용하는게 보기도 편하고 사용하기도 편할거 같다.

