## chapter05. 더 좋은 액션 만들기

### 비즈니스 요구 사항과 설계를 맞추기

gets_free_shopping() 함수는 비즈니스 요구 사항으로 봤을 때 맞지 않는 부분이 있다.
요구사항은 장바구니에 담긴 제품을 주문할 때 무료 배송인지 확인하는 것이다.

하지만 함수를 보면 장바구니로 무료 배송을 확인하지 않고 제품의 합계와 가격으로 확인하고 있다.

이것은 비즈니스 요구사항과 맞지 않는 인자다.

```js
function gets_free_shipping(total, item_price) {
    return item_price + total >= 20
}
```

또 중복된 코드도 있다. 합계에 제품 가격을 더하는 코드가 두군데 있다.

중복이 항상 나쁜 것은 아니지만 코드에서 나는 냄새다.

```js
function calc_total(cart) {
    let total = 0;
    for (let i = 0; i < cart.length; i++) {
        let item = cart[i]
        total += item.price //중복
    }
}
```

gets_free_shipping(total, item_price)를 gets_free_shipping(cart)로 바꾼다.

### 비즈니스 요구 사항과 함수를 맞추기

함수의 동작을 바꿨으므로 엄밀히 말하면 리팩토링이 아니다.

바꾼 함수는 합계와 제품 가격 대신 장바구니 데이터를 사용한다.

장바구니는 전자상거래에서 많이 사용하는 엔티티 타입이기 때문에 비즈니스 요구사항과 잘 맞는다.

함수 시그니처가 바뀌었기 때문에 사용 부분도 고쳐야 한다.

### 원칙: 암묵적 입력과 출력은 적을수록 좋다.

인자가 아닌 모든 입력은 암묵적 입력이고 리턴 값이 아닌 모든 출력은 암묵적 출력이다.

암묵적 입력과 출력이 없는 함수는 계산이다.

액션에서도 암묵적 입력과 출력을 줄이면 좋다.

__어떤 함수에 암묵적 입력과 출력이 있다면 다른 컴포넌트와 강하게 연결된 컴포넌트다.__

다른 곳에서 사용할 수 없기 때문에 모듈이 아니다. 이런 함수의 동작은 연결된 부분의 동작에 의존한다.

암묵적 입력과 출력을 명시적으로 바꿔 모듈화된 컴포넌트로 만들 수 있다. 납땜하는 대신 쉽게 떼었다 붙일 수 있는 커넥터로 연결된 것이라고 할 수 있다.

암묵적 출력과, 입력이 있는 함수는 조심해야 한다. 계산은 암묵적 입력과 출력이 없기 때문에 테스트하기 쉽다.

### 암묵적 입력과 출력 줄이기

최대한 전역변수를 모두 없애고, 리턴 값을 활용

### 코드 다시 살펴보기

shopping_cart_total() 전역변수와  calc_cart_total() 함수 수정.


### 계산 분류하기

계산을 cart에 대한 동작, item에 대한 동작, 비즈니스 규칙으로 분류

이렇게 나눈 것은 코드에서 의미있는 계층이 된다.


### 원칙: 설계는 엉켜있는 코드를 푸는 것이다.


함수를 사용하면 관심사를 분리할 수 있다. 함수는 인자로 넘기는 값과 그 값을 사용하는 방법을 분리한다. 분리된 것은 언제든 쉽게 조합이 가능하다.

작은 함수를 잘 설계하면 이점은 아래와 같다.

1. 재사용하기 쉽다
2. 유지보수가 쉽다
3. 테스트하기 쉽다

### add_item()을 분리해 더 좋은 설계 만들기

add_item() 함수는 네 부분으로 나눌 수 있다.

1. 배열 복사
2. item 객체를 만듦
3. 복사본에 item을 추가
4. 복사본을 리턴

item 구조만 알고 있는 함수 make_cart_item과 cart 구조만 알고 있는 함수로 나눠 원래 코드를 고침.

이렇게 하면 cart와 item을 독립적으로 확장할 수 있다. 

1번과 3번, 4번은 값을 바꿀 때 복사하는 카피-온-라이트를 구현한 부분임.

### 카피-온-라이트 패턴 빼기

add_item()과 add_element_last()로 분리함

add_element_last()는 유틸리티 함수로서 다양한 곳에서 재사용이 가능하다.

### 작은 함수와 많은 계산

1. 젼역변수, 젼역 변수 읽기, DOM 수정은 액션
2. 암묵적 입력과 출력이 없으면 계산

### 요점 정리

* 일반적으로 암묵적 입력과 출력은 인자와 리턴 값으로 바꿔 없애는 것이 좋다.
* 설계는 엉켜있는 것을 푸는 것이다. 풀려있는 것은 언제든 합칠 수 있다.
* 엉켜있는 것을 풀어 각 함수가 하나의 일만 하도록 하면, 개념을 중심으로 쉽게 구성할 수 있다.