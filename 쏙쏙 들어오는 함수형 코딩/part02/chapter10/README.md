## chapter 10. 일급 함수

함수 본문에서 사용하는 어떤 값이 함수 이름에 나타난다면 __함수 이름에 있는 암묵적 인자는__ 코드의 냄새가 된다.
아래 나오는 리팩토링을 사용하면 이를 해결할 수 있다.

특징

1. 거의 똑같이 구현된 함수가 있다.
2. 함수 이름이 구현에 있는 다른 부분을 가리킨다.

### 리팩터링 암묵적 인자를 드러내기

__암묵적 인자를 드러내기__ 리팩토링은 암묵적 인자가 일급 값이 되도록 함수에 인자를 추가한다.

이렇게 하면 잠재적 중복을 없애고 코드의 목적을 더 잘표현할 수 있다.

단계

1. 함수 이름에 있는 암묵적 인자를 확인한다.
2. 명시적인 인자를 추가한다.
3. 함수 본문에 하드 코딩된 값을 새로운 인자로 바꾼다.
4. 함수를 호출하는 곳을 고친다.

### 리팩토링: 함수 본문을 콜백으로 바꾸기

__함수 본문을 콜백으로 바꾸기__ 리팩토링으로 함수 본문에 어떤 부분을 콜백으로 바꾼다.
이렇게 하면 일급 함수로 어떤 함수에 동작을 전달할 수 있다.
이 방법으 원래 있던 코드를 고차 함수로 만드는 강력한 방법이다.

단계

1. 함수 본문에서 바꿀 부분의 앞부분과 뒷부분을 확인한다.
2. 리팩토링할 코드를 함수로 빼낸다.
3. 빼낸 함수의 인자로 넘길 부분을 또 다른 함수로 빼낸다.

### 마케팅팀은 여전히 개발팀과 협의해야 한다.

주어진 API로는 할 수 없는 일이 있으므로 새로운 API를 개발팀에 요청해야 한다. 아래는 새로운 요구사항이다.

1. 요구사항: 장바구니에 있는 제품 값을 설정하는 기능
2. 요구사항: 장바구니에 있는 제품 개수를 설정하는 기능
3. 요구사항: 장바구니에 있는 제품에 배송을 설정하는 기능

마케팅팀이 요청한 요구사항은 매우 비슷하다. 이제는 개발팀이 구현해주기를 기다려야한다. 추상화벽이 잘 동작하지 않고 있다.

### 코드의 냄새: 함수 이름에 있는 암묵적 인자

개발팀은 마케팅 팀을 위해 새로운 api를 개발하는데 코드가 매우 유사하다.

분명하게 중복이 보인다. 함수는 다 비슷하다. 필드를 결정하는 문자열이 함수 이름에 있다는 것이 문제다.
함수 이름에 있는 일부가 인자처럼 동작하는 것 같다. 그래서 이 냄새를 __함수 이름에 있는 암묵적 인자__ 라고 부른다.

값을 명시적으로 전달하지 않고 함수 이름의 일부로 전달하고 있다.

### 리팩터링: 암묵적 인자를 드러내기

함수 이름의 일부가 암묵적 인자로 사용되고 있다면 __암묵적 인자를 드러내기__ 리팩터링을 사용할 수 있다.
기본적인 아이디어는 암묵적 인자를 명시적 인자로 바꾸는 것이다.

아래는 리팩토링 단계다.

1. 함수 이름에 있는 암묵적 인자를 확인한다.
2. 명시적인 인자를 추가한다.
3. 함수 본문에 하드 코딩된 값을 새로운 인자로 바꾼다.
4. 함수를 부르는 곳을 고친다.

> setPriceByName, setQuantityByName을 setFieldByName라는 함수로 바꿨다.

리팩토링으로 필드명을 일급 값을 만들었다.
리팩토링 전에는 필드명이 함수 이름에 암묵적으로 있었고 API로도 제공되지 않았다.
하지만 이제 암묵적인 이름은 인자로 넘길 수 있는 값(여기서는 문자열)이 되었다.
값은 변수나 배열에 담을 수 있다.

그래서 __일급__ 이라고 부른다.
일급 값은 언어 전체에 어디서나 쓸 수 있다. 일급으로 만드는 것이 이번장의 주제다.

> 일급 값은 언어에 있는 다른 값처럼 쓸 수 있다.

### 일급인 것과 일급이 아닌 것을 구별하기

js에는 일급이 아닌 것과 일급이 섞여있다. 다른 언어도 마찬가지다.

js에서 숫자는 아래와 같은 일을 할 수 있다.

1. 숫자는 함수에 인자로 넘길 수 있고, 함수의 리턴 값으로도 받을 수 있다.
2. 변수에 넣을 수 있고 배열이나 객체의 항목으로 넣을 수도 있다.

문자열이나 불리언값, 배열, 객체도 비슷하게 할 수 있다. 
js나 다른 많은 언어에서 함수 역시 비슷하게 사용할 수 있다. 이런 식으로 사용할 수 있는 값을 __일급__ 이라고 한다.

js에서 일급이 아닌 것은 다음과 같다.

1. 수식 연산자
2. 반복문
3. 조건문
4. try/catch 블록

__일급으로 할 수 있는 것__
1. 변수에 할당
2. 함수의 인자로 넘기기
3. 함수의 리턴값으로 받기
4. 배열이나 객체에 담기

함수명은 일급이 아니므로 우리는 함수명의 일부를 인자로 바꿔 읽브으로 만들었다.
js는 객체 필드에 접근할 대 문자열을 사용할 수 있다.
앞에서 한 리팩토링으로 부족하지만 우리가 가진 문제를 잘해결할 수 있었다.

### 필드명을 문자열로 사용하면 버그가 생기지 않을까?

문제를 해결할 수 있는 방법은 두가지가 있다.

하나는 컴파일 타임에 검사하는 것과 다른 하나는 런타임에 검사하는 것이다.

컴파일 타임에 검사하는 방법은 주로 정적 타임 시스텝에서 사용한다. ex TS, JAVA

런타임 검사는 컴파일 타입에 동작하지 않고 함수를 실행할 때마다 동작한다. 
전달한 문자열이 올바른 문자열인지 확인한다. 자바스크립트는 정적 언어가 아니므로 런타임 검사 방법을 사용해야 한다.

### 일급 필드를 사용하면  API를 바꾸기 더 어렵나요?

엄밀히 말하면 지금 방식은 __구현이 외부에 노출된 것은 아니다__

만약 내부에서 정의한 필드명이 바뀐다고 해도 사용하는 사람들이 원래 필드명을 그대로 사용하게 할 수 있다.
내부에서 그냥 필드명을 바꿔주면 된다.

이런 방법은 필드명이 일급이기 때문에 할 수 있는 것이다. 필드명이 일급이라는 말은 객체나 배열에 담을 수 있다는 뜻이다.

### 객체와 배열을 너무 많이 쓰게 된다.

지금은 데이터를 사용할 때 임의의 인터페이스로 감싸지 않고 그대로 사용하고 있다. 
인터페이스를 잘 만들면 데이터를 정해진 방법으로만 쓸 수 있다. 하지만 장바구니와 제품 엔티티는 매우 일반적이다.
장바구니와 제품 엔티티는 커스텀 API 처럼 구체적인 것보다는 낮은 곳에 위치한다.

그래서 장바구니와 제품 엔티티에 일반적인 데이터 구조인 객체와 배열을 사용하는 것이다.

데이터를 데이터 그대로 사용하는 것의 중요한 장점은 다양한 방식으로 해석할 수 있다는 것이다.
제한된 API로 사용하면 데이터를 제대로 사용할 수 없다.
미래에 어떤 방법으로 해석될지 미리 알 수 없기 때문에 필요할 때 알맞은 방법으로 해석할 수 있어야 한다.

이것이 __데이터 지향__ 이라고 하는 중요한 원칙이다.

### 반복문 예제

반복문을 통해서 함수 이름에 있는 암묵적 인자 냄새의 특징을 확인했다.

1. 거의 똑같이 구현됐다. 
2. 함수 이름에 다른 부분이 함수에서 사용된다.

우리는 콜백 함수를 사용해서 냄새나는 코드를 깨끗한 코드로 리팩토링할 수 있었다.

함수를 인자로 받았으므로 인자로 넘어간 함수는 __고차 함수__ 다. 코드에서는 또한 익명 함수를 사용했다.

> 함수를 인자로 받으면 고차함수!!!!

다음은 코드 예시에서 보여준 리팩토링 단계다.

1. 코드를 함수로 감싸기
2. 더 일반적인 이름으로 바꾸기
3. 암묵적 인자를 드러내기
4. 함수 추출하기
5. 암묵적 인자를 드러내기

함수를 넘기는 방법은 세가지가 있다.

1. 전역 함수를 넘기기
2. 지역적으로 정의한 함수를 넘기기
3. 인라인으로 정의하기

js에서는 함수가 일급이기 때문에 아래와 같은 것이 가능하다.

1. 변수에 넣고 변수명 짓기
2. 컬렉션(배열)에 저장하기
3. 그냥 인자로 넘기기

또 선택적으로 호출하고, 나중에 호출하고, 새로운 문맥 안에서 호출하는 것도 가능하다.