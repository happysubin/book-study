# part 5. 스프링 데이터 JPA를 이용한 조회 기능

## chapter 5.1 시작에 앞서

* CQRS는 명령 모델과 조회 모델을 분리하는 패턴이다.
* 명령 모델은 상태를 변경하는 기능을 구현할 때 사용하고 조회 모델은 데이터를 조회하는 기능을 구현할 때 사용한다. Object에서 본 명령 쿼리 모델 느낌.
* 엔티티, 애그리거트, 리포지터리 등의 모델은 상태를 변경할 때 주로 사용한다. 즉 도메인 모델은 명령 모델로 주로 사용된다.
* 페이징, 정렬, 검색 조건 지정과 같은 기능은 조회 모델을 구현해서 사용한다.
* 리포지터리는 명령 모델에서 사용하는 것 같고, DAO는 데이터 접근, 즉 조회 모델에서 사용하는 것 같다.

## chapter 5.2 검색을 위한 스펙

* 검색 조건을 다양하게 조합해야 할 때 사용할 수 있는 것이 스펙이다. Specification.
* 스펙은 애그리거트가 특정 조건을 충족하는지를 검사할 때 사용하는 인터페이스다.
* Order 애그리거트 객체가 특정 고객의 주문인지 확인하는 스펙을 구현하는 코드를 살펴봄.
* 리포지터리나 DAO는 검색 대상을 걸러내는 용도로 스펙을 사용한다.
* 리포지터리가 스펙을 이용해서 검색 대상을 걸러주므로 특정 조건을 충족하는 애그리거트를 찾고 싶으면 원하는 스펙을 생성해서 리포지터리에 전달해 주기만 하면 된다.
* 하지만 실제 스펙은 이렇게 구현하지 않는다. 실제 스펙은 기술에 맞춰 구현하게 된다.
* 이번 장에서는 스프링 데이터 JPA를 이용한 스펙 구현에 대해 알아보겠다.

## chapter 5.3 스프링 데이터 JPA를 이용한 스펙 구현

* 스프링 데이터 JPA는 검색 조건을 표현하기 위한 인터페이스인 SPecification을 제공한다.
* 스펙 인터페이스에서 제네릭 타입 파리미터 T는 JPA 엔티티 타입을 의미한다.
* toPredicate() 메서드는 JPA 크리테리아 API에서 조건을 표현하는 Predicate을 생성한다.
* 예제 코드를 살펴봄. p.179. 정적 메타 모델에 대해서도 알아봄. p.180
* 스펙 구현 클래스를 개별적으로 만들지 않고 별도 클래스에 스펙 생성 기능을 모아도 된다.
* 예제 코드 181. 함수형 인터페이스를 사용

## chapter 5.4 리포지터리/DAO에서 스펙 사용하기

* findAll 메서드 파라미터로 스펙 인터페이스를 넣는 코드를 살펴봄. p.182
* 해당 코드처럼 메서드를 사용하면 작성한 스펙 구현체를 사용해서 특정 조건을 충족하는 엔티티를 찾을 수 있다.

## chapter 5.5 스펙 조합
