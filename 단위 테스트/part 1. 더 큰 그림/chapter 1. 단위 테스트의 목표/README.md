# Chapter 1. 단위 테스트의 목표

단위 테스트는 단순히 테스트를 작성하는 것보다 더 큰 범주다.

* 단위 테스트에 시간을 투자할 때는 항상 최대한 이득을 얻도록 노력해야 한다.
* 테스트에 드는 노력을 가능한 한 줄이고 그에 따르는 이득을 최대화해야 한다. 

첫 번째 챕터에서는 테스트 작성과 유지 보수의 목표를 설명하며 테스트 스위트를 잘 작성할 수 있는 방법을 소개한다.

## Section 1. 단위 테스트 현황

* 기업용 애플리케이션 개발 프로젝트는 거의 모두 단위 테스트가 적용돼 있다.
* 그중 상당수는 수많은 단위 테스트와 통합 테스트를 통해 좋은 코드 커버리지를 달성하고 있다.
* 제품 코드와 테스트 코드의 비율은 1:1에서 1:3 정도 된다.

> 그럼 좋은 단위테스트를 작성하는 것은 어떤 의미인가"

* 좋은 테스트와 좋지 않은 테스트의 차이는 취향이나 개인적인 선호도의 문제가 아니라 현재 작업 중인 중대한 프로젝트의 성패를 가르는 문제다.
* 단위 테스트의 단순한 배움을 넘어서, 이 책은 테스트 작성에 그치지 않고 노력 대비 최대의 이익을 끌어내는 방식으로 단위 테스트를 수행하는 것을 알려줄 것이다.
* 이상적인 단위 테스트에 대해 정확하고 과학적인 정의를 다룬다.

## Section 2. 단위 테스트의 목표

* 흔히 테스트 활동이 더 나은 설계로 이어진다고 한다.
* 코드베이스에 대해 단위 테스트 작성이 필요하면 일반적으로 더 나은 설계로 이어진다.
* 하지만 단위 테스트의 주 목표는 아니다. 더 나은 설계는 단지 좋은 사이드 이펙트일 뿐이다.

그럼 단위 테스트의 목표는 무엇일까??

> 소프트웨어 프로젝트의 지속 가능한 성장을 가능하게 하는 것이다. 지속 가능하다는 것이 핵심이다.

* 테스트가 없는 프로젝트의 경우 시작은 유리하지만, 이내 진척이 없을 정도로 느려진다.
* 이렇게 개발 속도가 빠르게 감소하는 현상을 소프트웨어 엔트로피라고도 한다. 
* 코드베이스에서 변경할 때마다 무질서도(엔트로피)는 증가한다.
* 지속적인 정리와 리팩터링 등과 같은 적절한 관리를 하지 않고 방치하면 시스템이 점점 더 복잡해지고 무질서해진다.

__테스트로 이러한 경향을 뒤집을 수도 있다.__
테스트는 새로운 기능을 도입하거나 새로운 요구 사항에 더 잘 맞게 리팩터링한 후에도 기존 기능이 잘 작동하는지 확인하는 데 도움이 된다.
 
테스트에도 단점이 존재하는데, 초반에 상당한 노력이 필요하다는 것이다.
그러나 프로젝트 후반에도 잘 성장할 수 있도록 하므로 장기적으로 보면 그 비용을 메울 수 있다.
코드베이스를 지속적으로 검증하는 테스트 없이는 소프트웨어 개발이 쉽게 확장되지 않는다.
지속성과 확장성이 핵심이며, 이를 통해 장기적으로 개발 속도를 유지할 수 있다.

### 좋은 테스트와 좋지 않은 테스트를 가르는 요인

단위 테스트가 프로젝트 성장에 도움이 되는 것은 맞지만,, 테스트를 작성하는 것만으로는 충분하지 않다. 잘못 작성한 테스트는 여전히 같은 결과를 낳는다. 
 
> 모든 테스트를 작성할 필요는 없다. 일부 테스트는 아주 중요하고 소프트웨어 품질에 매우 많은 기여를 한다. 그 밖에 테스트는 그렇지 않다.

테스트의 가치와 유지 비용을 모두 고려해야 한다. 비용 요소는 다양한 활동에 필요한 시간에 따라 결정된다.

* 기반 코드를 리팩터링할 때 테스트도 리팩터링하라.
* 각 코드 변경 시 테스트를 실행하라.
* 테스트가 잘못된 경고를 발생시킬 경우 처리하라.
* 기반 코드가 어떻게 동작하는지 이해하려고 할 때는 테스트를 읽는 데 시간을 투자하라.

지속 가능한 프로젝트 성장을 위해서는 고품질 테스트에만 집중해야 한다. 고품질 테스트만이 테스트 스위트에 남을 만한 테스트 유형이다.

## Section 3. 테스트 스위트 품질 측정을 위한 커버리지 지표

* 가장 널리 사용되는 두 가지 커버리지(코드 커버리지와 분기 커버리지)를 에 대해 알아본다.
* 그리고 커버리지 숫자를 목표로 하는 것이 해로운 이유와 테스트 스위트 품질을 결정하는 데 커버리지 지표에 의존할 수 없는 이유를 알아본다.

> 커버리지 지표는 테스트 스위트가 소스 코드를 얼마나 실행하는지를 백분율로 나타낸다.

* 커버리지 지표는 각기 다른 유형이 있으며, 테스트 스위트의 품질을 평가하는 데 자주 사용된다. 일반적으로 커버리지 숫자가 높을수록 더 좋다.
* 안타깝게도 그렇게 간단하지만은 않다. 커버리지 지표는 중요한 피드백을 주더라도 테스트 스위트 품질을 효과적으로 측정하는 데 사용될 수 없다.
* 코드 커버리지가 너무 적을 때는 테스트가 충분치 않다는 좋은 증거다. 그러나 반대의 경우는 그렇지 못하다.
* 100% 커버리지라고 해서 반드시 양질의 테스트 스위트라고 보장하지는 않는다.

### 코드 커버리지 지표

가장 많이 사용되는 코드 커버리지가 있으며, 테스트 커버리지라고 한다.

> 코드 커버리지(테스트 커버리지) = 제품 코드 라인 수 / 전체 라인 수

IF문을 사용하다가 return 문으로 수정했을 때의 커버리지 지표에 대한 문제를 살펴보았다.

### 분기 커버리지 지표

분기 커버리지는 코드 커버리지의 단점을 극복하는 데 도움이 되므로 코드 커버리지보다 더 정확한 결과를 제공한다.

> 분기 커버리지 = 통과 분기 / 전체 분기 수

분기 커버리지로 코드 커버리지보다 더 나은 결과를 얻을 수 있지만, 테스트 스위트의 품질을 결정하는 데 어떤 커버리지 지표도 의존할 수 없는 이유는 다음과 같다.

* 테스트 대상 시스템의 모든 가능한 결과를 검증한다고 보장할 수 없다.
  * if 문이 아닌 단순한 비교 연산자를 사용하는 코드를 살펴보았다.
* 외부 라이브러리의 코드 경로를 고려할 수 있는 커버리지 지표는 없다. 
  * 정수형 파싱 메서드를 살펴보았다.

> 결론적으로 테스트 스위트 품질을 결정하기에 커버리지 지표만으로는 충분치 않다는 것을 알 수 있다.

특정 커버리지 숫자를 목표로 하는 것은 단위 테스트의 목표와 반대되는 그릇된 동기 부여가 된다. 그래도 시스템의 핵심 부분은 커버리지를 높게 두는 것이 좋긴 하다.

## Section 4. 무엇이 성공적인 테스트 스위트를 만드는가?

__성공적인 테스트 스위트는 다음과 같은 특성을 가지고 있다.__

1. 개발 주기에 통합돼 있다. 
   * 모든 테스트는 개발 주기에 통합돼야 한다.
   * 코드가 변경될 때마다 아무리 작은 것이라도 실행해야 한다.
2. 코드베이스에서 가장 중요한 부분만을 대상으로 한다.
   * 시스템의 가장 중요한 부분에 단위 테스트 노력을 기울이고, 다른 부분은 간략하게 또는 간접적으로 검증하는 것이 좋다.
   * 대부분의 애플리케이션에서 가장 중요한 부분은 비즈니스 로젝(도메인 모델)이 있는 부분이다.
   * 비즈니스 로직 테스트가 시간 투자 대비 최고의 수익을 낼 수 있다.
3.최소한의 유지비로 최대의 가치를 끌어낸다.
   * 이 책의 핵심이다.
   * 가치가 유지비를 상회하는 테스트만 스위트에 유지하는 것이 중요하다. 이 마지막 속성은 두 가지로 나눌 수 있다.
   * 가치 있는 테스트를 식별하기와 가치 있는 테스트 작성하기다.
   * 가치 있는 테스트를 식별하려면 기준틀이 필요하고, 가치 있는 테스트를 작성하려면 코드 설계 기술도 알아야 한다.

## Section 5. 이 책을 통해 배우는 것

이 책을 통해 테스트 스위트 내의 모든 테스트를 분석하는 데 사용할 수 있는 기준틀을 설명한다. 이 기준틀이 기초다.
그러고 나서 새로운 관점에서 많은 테스트를 볼 수 있으며, 어떤 것이 프로젝트에 기여하고 어떤 것을 리팩토링해야 하거나 완전히 제거해야 하는지 알 수 있을 것이다.
다음 내용도 다룬다.

* 제품 코드와 관련된 테스트 스위트를 리팩터링하는 방법
* 단위 테스트를 다양한 스타일로 적용하는 방법
* 통합 테스트로 시스템 전체 동작 검증하기
* 단위 테스트 안티 패턴을 식별하고 예방하기

