# Chapter 3. 단위 테스트 구조

## Section 1. 단위 테스트를 구성하는 방법

1. Given - When - Then 패턴을 사용해서 실습을 진행했다.
2. 여러 개의 준비, 실행, 검증 구절은 피해야 한다. 
   * 즉 다단계 단위 테스트를 여러 개의 테스트로 나누어야 한다.
3. 테스트 내 if 문은 피해야 한다.
4. 각 구절은 얼마나 커야 하는가?
   * 준비 구절이 가장 큰 경우
     * 일반적으로 Given 구절이 제일 크다. 너무 크면 같은 테스트 클래스 내 비공개 메서드 또는 별도의 팩토리 클래스로 도출하는 것이 좋다.
   * 실행 구절이 한 줄 이상인 경우를 경계하라.
   * 검증 구절에는 검증문이 얼마나 있어야 하는가.
     * 테스트당 하나의 검증을 갖는 지침은 사실 올바르지 않다.
     * 단위 테스트의 단위는 동작의 단위이지 코드의 단위가 아니다.
     * 단일 동작 단위는 여러 결과를 낼 수 있으며, 하나의 테스트로 그 모든 결과를 평가하는 곳이 좋다.
   * 종료 단계는 어떤가
     * 대부분의 단위 테스트는 종료 구절이 필요 없다. 3부에서 통합테스트와 관련해 더 자세히 알아본다.
   * 테스트 대상 시스템 구별하기
     * SUT는 테스트에서 중요한 역할을 하는데, 애플리케이션에서 호출하고자 하는 동작에 대한 진입점을 제공한다.
     * 본인은 개인적으로 SUT보다는 target이 더 명확한 것 같다.
   * 준비, 실행, 검증 주석 제거하

## Section 2. xUnit 살펴보기

## Section 3. 테스트 간 테스트 픽스처 재사용 

테스트 픽스처라는 단어는 다음과 같이 두 가지 공통된 의미가 있다.

> 테스트 픽스처는 테스트 실행 대상 객체다. 이 객체는 정규 의존성, 즉 SUT로 전달되는 인수다. 
> 데이터베이스에 있는 데이터나 하드 디스크의 파일일 수도 있다. 이러한 객체는 각 테스트 실행 전에 알려진 고정 상태로 유지하기 때문에 동일한 결과를 생성한다.

테스트 픽스처를 재사용하는 첫 번째 (올바르지 않은) 방법은 __테스트 생성자에서 픽스처를 초기화__ 하는 것이다.
다음과 같은 단점이 존재한다.

* 테스트 간 결합도가 높아진다.
  * 테스트 간의 높은 결합도는 안티 패턴이다.
* 테스트 가독성이 떨어진다.
  * 테스트 가독성을 떨어트리는 생성자를 사용한다.

### 더 나은 픽스처 재사용법

* 더 나은 픽스처 재사용법은 테스트 클래스에 비공개 팩토리 메서드를 두는 것이다.
* 공통 초기화 코드를 비공개 __팩토리 메서드__ 로 추출해 테스트 코드를 짧게 하면서, 동시에 테스트 진행 상황에 대한 전체 맥락을 유지할 수 있다.
* beforeEach도 좋은 방식인 거 같은데 책에서는 언급되지 않았다. 다른 방식으로 기초 클래스의 공통 초기화 코드를 설명했다.
* 팩토리 메서드가 제일 좋은 방법인 것 같다.

## Section 4. 단위 테스트 명명법

테스트에 표현력이 있는 이름을 붙이는 것이 중요하다.
올바른 명칭은 테스트가 검증하는 내용과 기본 시스템의 동작을 이해하는 데 도움이 된다. 
 
표현력 있고 읽기 쉬운 테스트 이름을 지으려면 다음 지침을 따르자.

* 엄격한 명명 정책을 따르지 않는다. 복잡한 동작에 대한 높은 수준의 설명을 이러한 정책의 좁은 상자 안에 넣을 수 없다. 표현의 자유를 허용하자.
* 문제 도메인에 익숙한 비개발자들에게 시나리오를 설명하는 것처럼 테스트 이름을 짓자.
* 단어를 밑줄 표시로 구분한다. 그러면 특히 긴 이름에서 가독성을 향상시키는 데 도움이 된다.

리팩토링 예제를 봤는데 본인이 생각했을 때 그냥 한글로 테스트 코드 이름을 짜는 게 더 좋은 거 같기도 하다..

## Section 5. 매개변수화된 테스트 리팩터링하기

매개변수화된 테스트로 유사한 테스트에 필요한 코드의 양을 줄일 수 있다. 단점은 테스트 이름을 더 포괄적으로 만들수록 테스트 이름을 읽기 어렵게 하는 것이다.

## Section 6. 검증문 라이브러리를 사용한 테스트 가독성 향상

* 테스트 가독성을 높이기 위해 검증문 라이브러리를 사용한다.
