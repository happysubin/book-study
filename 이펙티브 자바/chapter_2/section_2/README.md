# chapter 2. 객체 생성과 파괴 

## section 2. 생성자에 매개변수가 많다면 빌더를 고려하라.

* 정적 팩터리와 생성자는 선택적 매개변수가 많을때 적절히 대응하기 어렵다.
* 이렇게 매개변수가 많은 경우에는 점층적 생성자 패턴을 사용할 수 있다.
* 그러나 매개변수 개수가 많아지면 클라이언트 코드를 작성하거나 읽기 어렵다.
* 다음 대안은 자바빈즈 패턴이다.
* 매개변수가 없는 생성자로 객체를 만든 후 세터 메서드들을 호출해 원하는 매개변수의 값을 설정하는 방식이다.
* 인스턴스를 만들기 쉽고, 그 결과 더 읽기 쉬운 코드가 됐지만 자바 빈즈에는 심각한 단점이 있다.
* 자바빈즈 패턴에서는 객체 하나를 만들려면 여러 개 호출해야 하고, 객체가 완전히 생성되기 전까지는 일관성이 무너진 상태에 놓이게 된다.
* 일관성이 깨진 객체가 만들어지면, 버그를 심은 코드와 그 버그 때문에 런타임에 문제를 겪는 코드가 물리적으로 멀리 떨어져 있을 것이므로 디버깅도 만만치 않다.
* 자바빈즈 패턴에서는 클래스를 불변으로 만들 수 없으며 스레드 안전성을 얻으려면 프로그래머가 추가 작업을 해줘야만 한다.

마지막 대안은 점층적 생성자 패턴의 안전성과 자바 빈즈 패턴의 가독성을 겸비한 빌더 패턴이다.

* 클라이언트는 필요한 객체를 직접 만드신 대신, 필수 매개변수만으로 생성자를 호출해 빌더 객체를 얻는다.
* 그런 다음 빌더 객체가 제공하는 일종의 세터 메서드들로 원하는 선택 매개변수들을 설정한다.
* 마지막으로 매개변수가 없는 build 메서드를 호출해 드디어 우리에게 필요한 객체를 얻는다.
* 빌더의 세터 메서드들은 빌더 자신을 반환하기 때문에 연쇄적으로 호출할 수 있다.
* 이런 방식을 메서드 호출이 흐르듯 연결된다는 뜻으로 플루언트 API 혹은 메서드 연쇄라 한다.
* 빌더 패턴은 명명된 선택적 매개변수를 흉내 낸 것이다.
* 빌더 패턴은 계층적으로 설계된 클래스와 함께 쓰기에 좋다.
* 추상 클래스는 추상 빌더를, 구체 클래스는 구체 빌더를 갖게 한다.
* 추상 빌더와, 구체 빌더를 사용하는 피자 예제를 살펴봄. 정말 코드 예쁘게 잘 짰다고 느낌.
* 생성자로는 누릴 수 없는 사소한 이점으로, 빌더를 이용하면 가변인수 매개변수를 여러 개 사용할 수 있다.
* 각각을 적절한 메서드로 나눠 선언하면 된다.
* 아니면 메서드를 여러 번 호출하고 각 호출 대 넘겨진 매개변수들을 하나로 모을 수 있다.

### 정리

* 빌더 패턴은 상당히 유연하다.
* 빌더 하나로 여러 객체를 순회하면서 만들 수 있고, 빌더에 넘기는 매개변수에 따라 다른 객체를 만들 수도 있다.
* 객체마다 부여되는 일련번호와 같은 특정 필드는 빌더가 알아서 채우도록 할 수도 있다.
* 단점도 존재하는데, 빌더부터 생성 비용이 크지는 않지만 성능에 민감한 상황에서는 문제가 될 수도 있다.
* 또한 점층적 생성자 패턴보다는 코드가 장황해서 매개변수가 4개 이상은 되어야 값어치를 한다.
* 매개변수가 많다면 빌더 패턴을 선택하자. 코드가 간결하고 안전하다.