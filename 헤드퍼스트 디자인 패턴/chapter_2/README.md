# chapter 2. 객체들에게 연락 돌리기(옵저버 패턴)

## 가상 모니터링 애플리케이션 알아보기

* 우리가 구현할 애플리케이션은 기상 스테이션(실제 기상 정보를 수집하는 물리 장비), Weather Date 객체(기상 스테이션으로부터 오는 정보를 추적하는 객체), 사용자에게 현재 기상 조건을 보여주는 디스플레이 장비, 이렇게 3가지 요소로 이루어진다.
* WeatherData 객체는 물리 기상 스테이션과 통신해서 갱신된 기상 데이터를 가져온다.
* 디스플레이를 업데이트하려면 우선 WeatherData 객체를 고쳐야한다.

구현 목표

* WeatherData 클래스에는 3가지 측정 값(온도, 습도, 기압)의 게터 메서드가 있다.
* WeatherData 객체에서는 기상 관측 값이 갱신될 때 마다 measurementsChanged 메서드가 호출될 것이다.
* 기상 데이터를 사용하는 디스플레이 요소 3가지를 구현해야 한다. 예를 들어 조건 디스플레이, 기상 통계 디스플레이, 기상 예보 디스플레이 등이 있다.
* 디스플레이를 업데이트하도록 measurementsChanged() 메서드에 코드를 추가한다.
* 다양한 디스플레이에 대한 확장성을 지원해야 한다.

처음 구현 코드 특징

* 인터페이스가 아닌 구체 클래스에 의존한다.
* 새로운 디스플레이 항목이 추가될 때마다 코드를 변경해야 한다.
* 바뀌는 부분을 캡슐화하지 않음.
* 디스플레이 항목들이 공통적인 인터페이스를 구현함.
* 실행 중에 디스플레이 항목ㅇ르 추가하거나 제거할 수 없다.
* WeatherData 클래스를 캡슐화 했다.

## 옵저버 패턴

* 신문사 + 구독자 = 옵저버 패턴
* __옵저버 패턴은 한 객체의 상태가 바뀌면 그 객체에 의존하는 다른 객체에게 연락이 가고 자동으로 내용이 갱신되는 방식으로 일대다 의존성을 정의한다.__
* 주제와 옵저버로 일대다 관계가 정의된다.
* 옵저버는 주제에 딸려 있으며 주제의 상태가 바뀌면 옵저버에게 정보가 전달된다.
* 옵저버 패턴은 여러 가지 방법으로 구현할 수 있지만, __보통은 주제 인터페이스와 옵저버 인터페이스가 들어있는 클래스 디자인으로 구현한다.__
* 예시에서는 WeatherData 클래스가 '일'이고 디스플레이 요소가 '다'이다.
* P.93 다이어그램은 ISP 원칙을 잘 지킨 것 같다. 기억해두자.
* 앙방향 일대다 구조다.
* 참고로 옵저버는 알림 순서에 의존하면 안된다.

### 느슨한 결합

* 느슨한 결합은 객체들이 상호작용할 수는 있지만, 서로를 잘 모르는 관계를 이미한다.
* 느슨한 결합을 활용하면 유연성이 아주 좋아진다. 옵저버 패턴은 느슨한 결합을 보여주는 훌륭한 예다.

옵저버 패턴은 다음과 같은 특징으로 느슨한 결합을 만든다.

* 주제는 옵저버가 특정 인터페이스를 구현한다는 사실만 안다.
* 옵저버는 언제든지 새로 추가할 수 있다.
* 새로운 형식의 옵저버를 추가할 때도 주제를 변경할 필요가 전혀 없다.
* 주제와 옵저버는 서로 독립적으로 재사용할 수 있다.
* 주제나 옵저버가 달라져도 서로에게 영향을 미치지 않는다.

다양한 라이브러리에서 옵저버 패턴을 사용한다. 자바 스윙, 자바스크립트의 이벤트, 코코아와 스위프트의 키-값 옵저빙 프로콜에서도 옵저버 패턴을 사용한다.

### 풀 방식으로 코드 바꾸기

* 지금 방식은 하나의 데이터만 갱신해도 되는 상황에서 update() 메서드에 모든 데이터를 보내도록 되어 있다.
* 예를들어 풍속 같은 새로운 데이터가 추가되면, 대부분의 update 메서드에서 풍속 데이터를 쓰지 않더라도 모든 디스플레이에 update 메서드를 수정해야하는 상황이 발생한다.
* 사실 주제가 옵저버로 데이터를 보내는 푸시를 사용하거나 옵저버가 데이터를 당겨오는 풀을 사용하는 방법 중 어느 하나를 선택하는 일은 구현 방법의 문제라고 볼 수 있다.
* __하지만 대체로 옵저버가 필요한 데이터를 골라서 가져가도록 만드는 방법이 더 좋다.__
* 옵저버가 푸시 방식에서 풀 방식을 사용하도록 리팩토링을 진행함.
* 역시 조회는 게터 메서드를 사용할 수 밖에 없는 것 같다.

## 디자인 원칙

* 상호작용하는 객체 사이에는 가능하면 느슨한 결합을 활용해야 한다.서

