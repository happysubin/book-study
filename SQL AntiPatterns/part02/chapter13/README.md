## chapter13. 인덱스 샷건

### 안티패턴: 무계획하게 인덱스 사용하기

* 인덱스를 불충분하게 정의하거나 아예 정의하지 않는다.
* 너무 많은 인덱스를 정의하거나 도움이 되지 않는 인덱스를 정의한다.
* 어떤 인덱스도 도움이 될 수 없는 쿼리를 실행한다.

일반적인 애플리케이션은 조회를 100번할 때 insert를 한번 한다. 따라서 인덱스를 유지하는게 매우 이득이다.

### 안티패턴 인식 방법

* 이게 내 쿼리인데, 어떻게 더 빠르게 하지?
* 모든 필드에 인덱스를 걸었는데, 왜 빠르지 않지?
* 인덱스가 데이터베이스를 느리게 만든다고 들었어. 그래서 나는 안쓸래

### 안티패턴이 합당한경우

최적화할 정도로 중요도가 높은 쿼리가 아닌데 최적화하는 경우

중복도가 높을때..? 

### 해법: 인덱스를 MENTOR해라

데이터베이스를 분석해 좋은 인덱스를 선정하기 위한 체크리스트를 기억하기 쉽게 나타내기 위해 MENTOR를 사용할 것이다.

* M Measure
  * 대부분의 DB는 쿼리가 실행된 시간을 로그로 남기는 방법을 제공, 가장 많은 비용이 들어간 작업을 식별할 수 있다. 
* E Explain
  * 실행 계획 확인
* N Nominate
  * 쿼리에서 인덱스를 사용하지 않고 테이블에 접근하는 부분을 살펴보자. 아래는 이를 위한 도구
  * ex MySQL Enterprise Query Analyzer, Oracle Automatic SQL Tuning Advisor
  * 쿼리 추적 통계 정보를 모으고 쿼리를 위해 있으면 좋은 새로운 인덱스 생성을 권고하는 등의 변경을 제안한다.
* T Test
  * 부하테스트..?
* O Optimize
  * 인덱스는 빈번하게 사용되는 데이터 구조로, 캐시 메모리에 보관할 좋은 후보다.
  * MySQL에서 버퍼풀을 최적화하는 사이즈를 정해놓는 느낌
* R Rebuild
  * 시간이 지나면서 데이터를 업데이트하고 삭제함에 따라, 인덱스도 점점 균형을 잃는다.
  * 인덱스를 주기적으로 정비하는 것이 좋다.
  * 인덱스를 최대한 활용하는 방법의 많은 부분은 벤더에 따라 다르기 때문에 본인이 사용하는 DB 제품을 연구해야 한다.
